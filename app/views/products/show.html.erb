<main class="wrap">
<section>
  <h1>
    <%= @product.name.capitalize %>
  </h1>
  <p>
    <strong>Description: </strong>
    <%= @product.description %>
  </p>
  <p>
    <strong>Price: $</strong>
    <%= '%.2f' % @product.price %>
  </p>
  <p>
    <strong>Average rating:</strong>
    <%= render partial:"/layouts/stars", locals: {rating: @product.average_rating} %>
  </p>
</section>

<section>
  <h3>Categories:</h3>
  <% @product.categories.each do |cat| %>
    <%= cat.name%>
  <% end  %>
</section>

<p class="image"><%= image_tag "#{@product.photo_url}", alt:"image"%></p>

<% if @product.retired != true %>
<section>
  <em>Currently in stock:</em> <%= @product.inventory %>
</section>

<section>
  <%= form_tag create_order_product_path(product_id: @product.id), method: :post do %>

  <%= text_field_tag "quantity", 1 %>

  <%= submit_tag "Add to Cart", class: "buy button" %>
  <% end %>
</section>
<% else %>
<section>
  This product is retired.
  <% if session[:merchant_id] == @product.merchant_id %>
    <p>
      <%= link_to @product.retired ? "Unretire Product" : "Retire Product", retire_product_path(@product), method: :patch, class: "button" %>
    </p>
  <% end %>
</section>
<% end %>

  <p>Reviews:
    <% @product.reviews.each do |review| %>
  </p>
  <%= review.text %>
  <%= render partial:"/layouts/stars", locals: {rating: review.rating} %>
  <% end %>



<p><%= link_to "Back to All Products", products_path, class: "button" %></p>
<p><%= link_to "Write a Review", new_product_review_path(@product), class: "button" %></p>
<% if session[:merchant_id] == @product.merchant_id %>
<p><%= link_to "Edit", edit_product_path(@product), class: "button" %></p>
<!-- maybe include retire button -->
<% end %>
<%# link_to "Delete", product_path(@product), class: "alert button", method: "delete", data: { confirm: "Are you sure?" } %>
</main>
